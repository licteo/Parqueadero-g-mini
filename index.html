<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Parqueadero PRO - Vista Optimizada</title>
    
    <link rel="icon" type="image/png" href="icono.png">
    <link rel="apple-touch-icon" href="icono.png">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background-color: #f4f7f9; padding: 10px; color: #333; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        h1 { text-align: center; margin-bottom: 15px; color: #2c3e50; font-size: 1.5rem; }
        #tituloReporte { display: none; text-align: center; text-transform: uppercase; margin-bottom: 10px; font-weight: bold; border-bottom: 2px solid #333; }

        .form-card { background: #fff; padding: 12px; border: 1px solid #e1e8ed; border-radius: 10px; margin-bottom: 15px; }
        .form-group { margin-bottom: 10px; position: relative; }
        label { display: block; margin-bottom: 3px; font-weight: bold; font-size: 0.8rem; color: #555; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ccd6dd; border-radius: 8px; font-size: 0.9rem; outline: none; }
        
        .btn-input-action { position: absolute; right: 5px; top: 22px; display: flex; gap: 4px; }
        .circle-btn { background: #ebf5fb; border: 1px solid #3498db; border-radius: 50%; width: 34px; height: 34px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1rem; }
        
        .form-row { display: flex; gap: 8px; }
        .form-row .form-group { flex: 1; }
        #btnRegistrar { width: 100%; padding: 12px; background: #3498db; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 5px; }

        .tool-bar { display: flex; justify-content: space-between; margin-bottom: 10px; gap: 8px; }
        .btn-tool { flex: 1; padding: 10px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; font-size: 0.75rem; color: white; }
        
        .filter-bar { display: flex; gap: 5px; overflow-x: auto; padding-bottom: 8px; margin-bottom: 10px; }
        .filter-btn { padding: 6px 12px; border: 1px solid #3498db; background: white; color: #3498db; border-radius: 15px; white-space: nowrap; font-size: 0.7rem; font-weight: 600; cursor: pointer; }
        .filter-btn.active { background: #3498db; color: white; }

        /* TABLA MEJORADA */
        table { width: 100%; border-collapse: collapse; margin-top: 5px; background: white; }
        th { background: #f8f9fa; font-size: 9px; font-weight: bold; border: 1px solid #ddd; padding: 6px 2px; text-transform: uppercase; }
        td { border: 1px solid #eee; padding: 6px 2px; text-align: center; font-size: 10px; vertical-align: middle; }
        
        /* Ajuste de anchos para evitar colisiones */
        .col-foto { width: 45px; }
        .col-prop { width: 75px; }
        .col-placa { width: 65px; font-weight: bold; color: #2c3e50; }
        .col-ent { width: 70px; line-height: 1.1; }
        .col-dias { width: 35px; font-weight: bold; }
        .col-obs { width: auto; text-align: left !important; padding-left: 5px !important; }
        .col-est { width: 85px; }

        .status-badge { display: inline-block; padding: 3px 6px; border-radius: 10px; font-size: 8px; font-weight: bold; cursor: pointer; min-width: 55px; }
        .img-tabla { width: 40px; height: 30px; object-fit: cover; border-radius: 4px; }
        .btn-del { background: #fdf2f2; border: 1px solid #feb2b2; color: #e53e3e; border-radius: 4px; padding: 4px; cursor: pointer; margin-left: 3px; font-size: 0.8rem; }

        @media print {
            .form-card, .filter-bar, .tool-bar, h1, .btn-input-action, .btn-del { display: none !important; }
            #tituloReporte { display: block !important; }
            .container { width: 100%; box-shadow: none; padding: 0; }
            table { border: 1px solid #000; font-size: 10pt; }
            th, td { border: 1px solid #000 !important; color: black !important; }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>üÖøÔ∏è Parqueadero PRO</h1>
        <div id="tituloReporte">REPORTE DE VEH√çCULOS</div>

        <section class="form-card">
            <div class="form-row">
                <div class="form-group" style="flex: 2;">
                    <label>Placa</label>
                    <input type="text" id="placa" placeholder="Ej: HFY08G" style="text-transform:uppercase">
                    <div class="btn-input-action">
                        <button class="circle-btn" onclick="document.getElementById('inputCamara').click()">üì∏</button>
                        <button class="circle-btn" onclick="activarVoz('placa')">üé§</button>
                    </div>
                    <input type="file" id="inputCamara" accept="image/*" capture="camera" style="display:none" onchange="procesarFoto(this)">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>Estado Inicial</label>
                    <select id="estadoRegistro">
                        <option value="Pendiente">Pendiente ‚è≥</option>
                        <option value="Pagado">Pagado ‚úÖ</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label>Fecha Manual (Si aplica)</label>
                <input type="datetime-local" id="fechaManual">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Propietario</label>
                    <input type="text" id="propietario">
                </div>
                <div class="form-group">
                    <label>Categor√≠a</label>
                    <select id="categoria">
                        <option value="Moto Diario">Moto Diario</option>
                        <option value="Moto Mensual">Moto Mensual</option>
                        <option value="Buseta">Buseta</option>
                        <option value="Particular">Particular</option>
                        <option value="Pintores">Pintores</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label>Observaciones</label>
                <input type="text" id="observaciones">
            </div>
            
            <button id="btnRegistrar" onclick="registrarVehiculo()">Registrar Entrada</button>
        </section>

        <div class="tool-bar">
            <button onclick="window.print()" class="btn-tool" style="background:#27ae60;">üñ®Ô∏è PDF</button>
            <button onclick="borrarTodo()" class="btn-tool" style="background:#7f8c8d;">üßπ Limpiar</button>
        </div>

        <div class="filter-bar">
            <button class="filter-btn active" onclick="filtrar('Todas')">Todas</button>
            <button class="filter-btn" onclick="filtrar('Moto')">Motos</button>
            <button class="filter-btn" onclick="filtrar('Buseta')">Busetas</button>
            <button class="filter-btn" onclick="filtrar('Particular')">Particular</button>
        </div>

        <table>
            <thead>
                <tr>
                    <th class="col-foto">FOTO</th>
                    <th class="col-prop">PROPIETARIO</th>
                    <th class="col-placa">PLACA</th>
                    <th class="col-ent">ENTRADA</th>
                    <th class="col-dias">D√çAS</th>
                    <th class="col-obs">OBSERVACIONES</th>
                    <th class="col-est">ESTADO</th>
                </tr>
            </thead>
            <tbody id="cuerpoTabla"></tbody>
        </table>
    </div>

    <script>
        let registros = JSON.parse(localStorage.getItem('parqueadero_db')) || [];
        let filtroActual = "Todas";
        let fotoTemp = "";

        function procesarFoto(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) { fotoTemp = e.target.result; alert("Foto lista üì∏"); }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function activarVoz(id) {
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'es-ES';
            recognition.onresult = (e) => { document.getElementById(id).value = e.results[0][0].transcript.toUpperCase(); };
            recognition.start();
        }

        function registrarVehiculo() {
            const placa = document.getElementById('placa').value.trim().toUpperCase();
            if(!placa) return alert("Ingrese una placa");

            if(registros.find(r => r.placa === placa)) return alert("Esta placa ya est√° registrada.");

            let fecha = new Date();
            if(document.getElementById('fechaManual').value) fecha = new Date(document.getElementById('fechaManual').value);

            const fechaT = fecha.toLocaleDateString([], {day:'2-digit', month:'2-digit'}) + " " + fecha.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', hour12: true});

            registros.push({
                id: Date.now(),
                placa: placa,
                foto: fotoTemp,
                propietario: document.getElementById('propietario').value || "---",
                categoria: document.getElementById('categoria').value,
                observaciones: document.getElementById('observaciones').value || "---",
                entrada: fechaT,
                entradaRaw: fecha.getTime(),
                estado: document.getElementById('estadoRegistro').value
            });

            localStorage.setItem('parqueadero_db', JSON.stringify(registros));
            fotoTemp = ""; 
            document.getElementById('placa').value = "";
            document.getElementById('propietario').value = "";
            document.getElementById('observaciones').value = "";
            renderizar();
        }

        function alternarEstado(id) {
            registros = registros.map(r => {
                if(r.id === id) r.estado = r.estado.includes("Pendiente") ? "Pagado ‚úÖ" : "Pendiente ‚è≥";
                return r;
            });
            localStorage.setItem('parqueadero_db', JSON.stringify(registros));
            renderizar();
        }

        function calcularDias(raw) {
            const d = Math.floor((new Date().getTime() - raw) / (1000 * 60 * 60 * 24));
            return d < 0 ? 0 : d;
        }

        function filtrar(cat) {
            filtroActual = cat;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            renderizar();
        }

        function darSalida(id) {
            if(confirm("¬øEliminar?")) {
                registros = registros.filter(r => r.id !== id);
                localStorage.setItem('parqueadero_db', JSON.stringify(registros));
                renderizar();
            }
        }

        function borrarTodo() {
            if(confirm("¬øLimpiar toda la lista?")) {
                registros = [];
                localStorage.setItem('parqueadero_db', JSON.stringify(registros));
                renderizar();
            }
        }

        function renderizar() {
            const cuerpo = document.getElementById('cuerpoTabla');
            cuerpo.innerHTML = "";
            
            let lista = registros.filter(r => filtroActual === "Todas" || r.categoria.includes(filtroActual));
            
            // ORDEN ALFAB√âTICO POR PLACA
            lista.sort((a, b) => a.placa.localeCompare(b.placa));

            lista.forEach(reg => {
                const d = calcularDias(reg.entradaRaw);
                const isP = reg.estado.includes("Pagado");
                cuerpo.innerHTML += `
                    <tr>
                        <td class="col-foto">${reg.foto ? `<img src="${reg.foto}" class="img-tabla">` : '---'}</td>
                        <td class="col-prop">${reg.propietario}</td>
                        <td class="col-placa">${reg.placa}</td>
                        <td class="col-ent">${reg.entrada}</td>
                        <td class="col-dias" style="color:${d > 0 ? 'red':'inherit'}">${d}</td>
                        <td class="col-obs">${reg.observaciones}</td>
                        <td class="col-est">
                            <span class="status-badge" onclick="alternarEstado(${reg.id})" 
                                  style="background:${isP ? '#e6fffa':'#fff5f5'}; color:${isP ? '#2c7a7b':'#c53030'}; border:1px solid ${isP ? '#b2f5ea':'#feb2b2'}">
                                ${reg.estado.split(' ')[0]}
                            </span>
                            <button class="btn-del" onclick="darSalida(${reg.id})">üóëÔ∏è</button>
                        </td>
                    </tr>`;
            });
        }
        renderizar();
    </script>
</body>
</html>
